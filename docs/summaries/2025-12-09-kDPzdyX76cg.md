# Build a voice agent with LangChain

**Channel:** LangChain
**Published:** 2025-12-09
**Video:** [Watch on YouTube](https://youtube.com/watch?v=kDPzdyX76cg)

---

# 使用 LangChain 打造端到端的語音代理人

## 重點摘要
這支影片提供了一份全面指南，教你如何使用 LangChain 的「三明治」架構來打造高效能的語音代理人。影片強調，透過一個由語音轉文字、代理人推理、文字轉語音組成的模組化管線，並以事件串流模式連接，是優化低延遲的關鍵。

## 故事大綱
- **開場：** LangChain 的 Hunter 介紹了本次目標：建立一個語音代理人。他先展示了一個三明治點餐機器人作為最終成品範例，並提供了對應的 GitHub 程式碼庫連結。
- **中段：** 影片解釋了語音代理人的兩種主要架構：「即時模型」和「三明治」方法 (VAD -> STT -> Agent -> TTS)。影片詳述了兩者的優缺點，並因其靈活性及可使用最新推理模型的能力，推薦採用「三明治」方法。接著討論了關鍵組件（STT、TTS、VAD、代理人）和音訊傳輸方式（WebRTC、WebSockets），並強調在每個步驟中將延遲降到最低的極度重要性。
- **結尾：** 影片提出了一個強大的「事件串流」模式作為實作方法。此模式將一個聚合的事件流貫穿整個管線，從而實現即時反應（如處理打斷）和詳細的可觀察性。最後透過一段 TypeScript 程式碼演練，展示了如何組織這些不同的組件。

## 關鍵見解
1.  **延遲是王道：** 為了實現自然對話，語音代理人的回應時間（Time to First Byte）必須在 750 毫秒以下。管線中的每個組件都必須為速度進行優化，主要手段是透過串流（streaming）。
2.  **「三明治」架構提供靈活性：** 雖然一體化的「即時模型」速度很快，但模組化的「三明治」方法（VAD -> STT -> Agent -> TTS）讓你能夠為每個環節（特別是推理）選用最頂級的模型，並避免被單一供應商鎖定。
3.  **工具呼叫會增加顯著延遲：** 與文字代理人不同，語音代理人中的每一次工具呼叫都會帶來明顯的延遲。對於頻繁存取的資訊（如商品庫存），最好將其寫入系統提示中，而不是進行即時的工具呼叫。
4.  **事件串流是個強大的模式：** 將資料流建構成單一、聚合的事件串流（輸入、轉錄、代理人動作、音訊輸出），可以實現處理使用者打斷、提供豐富的 UI 回饋以及簡化可觀察性等進階功能。
5.  **推薦使用託管基礎設施：** 自行建構穩定、可擴展的音訊傳輸（透過 WebRTC 或 WebSockets）相當複雜。使用像 LiveKit、Daily 或 Twilio 這樣的託管服務可以大幅簡化開發過程。

## 精彩時刻
- 開頭的「三明治」點餐機器人展示，有效地呈現了最終目標。
- 對於為何將此模組化架構稱為「三明治」方法的清晰解釋。
- 「工具呼叫會增加延遲」這個警告。對於從文字轉向語音代理人的開發者來說，這是一個關鍵但不明顯的限制。
- 事件串流管線的視覺圖表和解釋，這是影片中為打造穩健代理人所提出的核心技術解決方案。

---

# Building an End-to-End Voice Agent with LangChain

## TL;DR
This video provides a comprehensive guide to building high-performance voice agents using LangChain's "Sandwich" architecture. It emphasizes optimizing for low latency by using a modular pipeline of speech-to-text, agent reasoning, and text-to-speech, all connected via an event streaming pattern.

## Story Flow
- **Beginning:** Hunter from LangChain introduces the goal: building a voice agent. He demos a sandwich-ordering bot to show the final product and points to the corresponding GitHub repo.
- **Middle:** The video explains the two main architectures for voice agents: "Real-time" models and the "Sandwich" method (VAD -> STT -> Agent -> TTS). It details the pros and cons of each, recommending the "Sandwich" approach for its flexibility and ability to use the latest reasoning models. Key components (STT, TTS, VAD, Agent) and audio transport methods (WebRTC, WebSockets) are discussed, along with the critical importance of minimizing latency at every step.
- **End:** The video presents a powerful "event streaming" pattern for implementation. This involves passing an aggregated stream of events through the pipeline, allowing for real-time reactions (like interruptions) and detailed observability. A code walkthrough of a TypeScript implementation demonstrates how to orchestrate these different components.

## Key Insights
1.  **Latency is King:** For a natural conversation, a voice agent's response time (Time to First Byte) must be under 750ms. Every component in the pipeline must be optimized for speed, primarily through streaming.
2.  **The "Sandwich" Architecture Offers Flexibility:** While all-in-one "Real-time" models are fast, the modular "Sandwich" approach (VAD -> STT -> Agent -> TTS) allows you to use the best-in-class models for each component (especially for reasoning) and avoid vendor lock-in.
3.  **Tool Calls Add Significant Latency:** Unlike text agents, every tool call in a voice agent adds a noticeable delay. For frequently accessed information (like product availability), it's better to bake it into the system prompt rather than making a live tool call.
4.  **Event Streaming is a Powerful Pattern:** Structuring the data flow as a single, aggregated stream of events (input, transcription, agent action, audio output) enables advanced features like handling user interruptions, providing rich UI feedback, and simplifying observability.
5.  **Managed Infrastructure is Recommended:** Building robust, scalable audio transport (via WebRTC or WebSockets) is complex. Using managed services like LiveKit, Daily, or Twilio can significantly simplify development.

## Notable Moments
- The "Sandwich" ordering bot demo at the start effectively showcases the final goal.
- The clear explanation of why the modular architecture is called the "Sandwich" method.
- The warning: "Tool calls add latency." This is a crucial, non-obvious constraint for developers moving from text to voice agents.
- The visual diagram and explanation of the event streaming pipeline, which is the key technical solution presented for building a robust agent.
